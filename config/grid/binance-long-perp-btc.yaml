grid_system:
  # ============================================================================
  # 基础配置
  # ============================================================================
  exchange: "binance"
  symbol: "BTC/USDT:USDT"          # Binance永续合约格式：BTC/USDT:USDT
  grid_type: "follow_long"         # 网格类型：follow_long(价格移动) | long(固定范围) | martingale_long(马丁)

  # ============================================================================
  # 价格移动网格参数（grid_type = "follow_long"）- 保守型配置
  # ============================================================================
  follow_grid_count: 500           # 网格数量（保守：500格，降低风险）
  follow_timeout: 1000000000000    # 脱离超时（秒，设置超大值表示不脱离）
  follow_distance: 3               # 脱离距离（格，保守：3格）
  price_offset_grids: 15           # 价格偏移（格，保守：15格，留更多缓冲）

  # ============================================================================
  # 固定范围网格参数（grid_type = "long" | "martingale_long"）
  # ============================================================================
  # 启用固定范围网格时，取消下面注释，并注释掉上面的follow参数
  # price_range:
  #   lower_price: 85000.0         # 网格下限（USDT）
  #   upper_price: 100000.0        # 网格上限（USDT）

  # ============================================================================
  # 通用网格参数 - 保守型配置
  # ============================================================================
  grid_interval: 50                # 每格间隔（USDT）- 保守：50（更大间隔，降低频繁交易）
  order_amount: 0.001              # 每格基础数量（BTC）- 保守：最小量 0.001
  quantity_precision: 3            # 数量精度（小数位）- Binance BTC是3位
  price_decimals: 1                # 价格精度（小数位）- Binance BTC是1位
  margin_mode: "cross"             # 保证金模式：cross(全仓) | isolated(逐仓)
  leverage: 5                      # 杠杆倍数（保守：5倍，降低爆仓风险）
  # martingale_increment: 0.0002   # 马丁递增（仅martingale模式生效）

  # ============================================================================
  # 🔥 剥头皮模式（持仓过大时自动减仓）- 保守型配置
  # ============================================================================
  # 工作原理：
  #   - 监控当前持仓在网格中的位置（百分比）
  #   - 达到触发阈值时，立即市价平仓至目标位置
  #   - 示例：45%触发阈值，15格止盈 → 跌到第225格触发，平仓到第210格
  # 适用场景：
  #   - 单边行情：价格持续下跌，持仓不断增加
  #   - 风险控制：防止持仓过大导致爆仓
  #   - 保守策略：更早触发，更大止盈幅度
  # ============================================================================
  scalping_enabled: true           # 是否启用（强烈推荐）
  scalping_trigger_percent: 45     # 触发阈值（保守：45%，更早触发）
  scalping_take_profit_grids: 15   # 止盈网格数（保守：15格，更大止盈）

  smart_scalping_enabled: true     # 智能剥头皮（允许多次深度探底）
  allowed_deep_drops: 0            # 允许深度下跌次数（保守：0次，不允许深跌）
  min_drop_threshold_percent: 10   # 最小下跌阈值（保守：10%）

  # ============================================================================
  # 🛡️ 本金保护模式（价格大跌时紧急止损）- 保守型配置
  # ============================================================================
  # 工作原理：
  #   - 价格跌破触发阈值时，立即市价平仓所有持仓
  #   - 取消所有网格订单，保护本金
  # 适用场景：
  #   - 瀑布行情：价格快速下跌（如跌破关键支撑位）
  #   - 黑天鹅事件：突发利空消息
  # 保守型设置：
  #   - 更早触发（20%），更好保护本金
  #   - 适合风险厌恶型投资者
  # ============================================================================
  capital_protection_enabled: true   # 保守：必须启用
  capital_protection_trigger_percent: 20  # 保守：20%触发（更早保护）

  # ============================================================================
  # 💰 止盈模式（盈利达标时锁定利润）- 保守型配置
  # ============================================================================
  # 工作原理：
  #   - 监控累计盈利占本金的百分比
  #   - 达到目标盈利时，市价平仓并停止网格
  # 适用场景：
  #   - 达到盈利目标，落袋为安
  #   - 担心行情反转，保护已有利润
  # 保守型设置：
  #   - 较低目标（0.5%），快速止盈
  #   - 适合追求稳健收益
  # ============================================================================
  take_profit_enabled: true        # 保守：启用止盈
  take_profit_percentage: 0.005    # 保守：0.5%即止盈（落袋为安）

  # ============================================================================
  # 🔒 价格锁定模式（价格突破阈值时暂停交易）
  # ============================================================================
  # 工作原理：
  #   - 价格向盈利方向脱离网格且达到阈值时，冻结网格
  #   - 不平仓，保留订单和持仓，等待价格回落
  #   - 价格回到网格范围内时，自动解除冻结
  # 适用场景：
  #   - 看好后市：价格突破后还可能继续上涨
  #   - 避免过早止盈：等待更高的价格回落
  # 推荐设置：
  #   - 做多网格：设置关键阻力位（如整数关口）
  #   - 示例：BTC在$95,000突破后锁定，等待回落到网格
  # ============================================================================
  price_lock_enabled: false        # 是否启用
  price_lock_threshold: 100000.0   # 锁定阈值（价格>=阈值时锁定）
  price_lock_start_at_threshold: false  # 启动时使用阈值作为起点（仅FOLLOW模式）

  # ============================================================================
  # 🛑 止损保护模式（亏损方向脱离时自动处理）- 保守型配置
  # ============================================================================
  # 工作原理：
  #   - 价格向亏损方向脱离网格且持续N秒时触发
  #   - 判断实时APR（过去10分钟）：
  #     * APR >= 阈值 → 市价平仓 + 重置网格（继续交易）
  #     * APR < 阈值 → 市价平仓 + 停止程序（退出）
  # 保守型设置：
  #   - 更早触发（85%），更短超时（300秒）
  #   - 更高APR阈值（50%），更严格的重启条件
  # ============================================================================
  stop_loss_protection_enabled: true  # 保守：必须启用
  stop_loss_trigger_percent: 85.0  # 保守：85%触发（更早止损）
  stop_loss_escape_timeout: 300    # 保守：5分钟超时（更快决策）
  stop_loss_apr_threshold: 50.0    # 保守：50% APR阈值（更严格重启条件）

  # ============================================================================
  # 🧹 退出清理模式（Ctrl+C 时自动平仓和取消订单）
  # ============================================================================
  exit_cleanup_enabled: true       # 是否启用（强烈推荐启用）

  # ============================================================================
  # 其他配置 - 保守型
  # ============================================================================
  reverse_order_grid_distance: 3   # 反手挂单距离（保守：3格，更安全）
  order_health_check_enabled: true  # 订单健康检查（必须启用）
  order_health_check_interval: 180  # 健康检查间隔（保守：3分钟，更频繁）
  health_check_snapshot_count: 3   # 健康检查快照次数（保守：3次，更准确）
  rest_position_query_interval: 60  # REST持仓查询间隔（保守：1分钟，更频繁）
  enable_notifications: false      # 通知开关（需要配置通知服务）
  fee_rate: 0.0004                 # 手续费率（Binance: Maker 0.02%, Taker 0.04%）

# ============================================================================
# 📝 配置说明
# ============================================================================
#
# 1. Binance 特殊要求：
#    - symbol格式必须是：BTC/USDT:USDT（永续合约）
#    - 最小下单量：0.001 BTC
#    - 价格精度：1位小数（如 91234.5）
#    - 数量精度：3位小数（如 0.001）
#    - 杠杆倍数：1-125倍（推荐10-20倍）
#
# 2. 网格参数建议：
#    - 保守：interval=50, grids=500, leverage=10
#    - 中等：interval=30, grids=700, leverage=15
#    - 激进：interval=20, grids=1000, leverage=20
#
# 3. 资金管理：
#    - 每格价值：order_amount × 当前价格 ≈ 0.001 × $91,000 = $91
#    - 总投入（满仓）：$91 × 1000格 = $91,000（20倍杠杆需$4,550本金）
#    - 建议：根据账户资金调整order_amount和杠杆倍数
#
# 4. 风险控制：
#    - 必须启用：scalping_enabled（防止持仓过大）
#    - 建议启用：capital_protection_enabled（防止瀑布行情）
#    - 建议启用：stop_loss_protection_enabled（智能止损）
#    - 必须启用：exit_cleanup_enabled（退出时自动清理）
#
# 5. API 密钥配置：
#    - 配置文件：config/exchanges/binance_config.yaml
#    - 需要权限：现货与杠杆交易、合约交易
#    - 白名单IP：建议绑定服务器IP
#
# 6. 启动命令：
#    python3 run_grid_trading.py config/grid/binance-long-perp-btc.yaml
#    python3 run_grid_trading.py config/grid/binance-long-perp-btc.yaml --debug
#
# ============================================================================
